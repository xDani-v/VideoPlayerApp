workflows:
  android:
    name: Android Workflow
    environment:
      vars:
        # Variables de entorno para la firma
        CM_KEYSTORE: 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
        CM_KEYSTORE_PASSWORD: admin1234
        CM_KEY_ALIAS: testapp
        CM_KEY_PASSWORD: admin1234
      node: 20.18.0
    scripts:
      - name: Install dependencies
        script: npm install
      - name: Build Ionic project
        script: ionic build
      - name: Sync Capacitor
        script: npx cap sync android
      - name: Grant execute permissions to gradlew
        script: chmod +x android/gradlew
      - name: Build Android app
        script: |
          cd android
          ./gradlew assembleRelease
      - name: Sign the APK
        script: |
          jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore $CM_KEYSTORE -storepass $CM_KEYSTORE_PASSWORD -keypass $CM_KEY_PASSWORD android/app/build/outputs/apk/release/app-release-unsigned.apk $CM_KEY_ALIAS
          $ANDROID_HOME/build-tools/30.0.3/zipalign -v 4 android/app/build/outputs/apk/release/app-release-unsigned.apk android/app/build/outputs/apk/release/app-release.apk
    artifacts:
      - android/app/build/outputs/**/*.apk
    publishing:
      email:
        recipients:
          - your-email@example.com